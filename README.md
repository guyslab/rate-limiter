# מגביל קצב
## מטרה
בהינתן פעולה לביצוע, המטרה היא להגביל את קצב ביצוע של הפעולה, כאשר היא מתבקשת במקביל.
## סוג חלון הזמן
ההגבלה יכולה להיעשות (בזמן התכנון, לא בזמן ריצה) לפי חלונות זמן גולשים (משתנים) או קלנדריים (מוחלטים).
לצורך קבלת ההחלטה, נבחן דוגמה:
### דוגמה
נניח שרוצים להגביל את ביצוע פעולה כלשהי בחלון זמן אחד: לא יותר מ-1000 ביצועים ביום. בפועל נתבקשו הקריאות הבאות:
* בדקה 23:59 ביום א 900 קריאות
* בדקה 00:00 ביום ב 900 קריאות
* לא נתבקשו עוד קריאות מעבר לכך

אם החלון הוא מוחלט/קלנדרי אז ביום א לא עברנו את הסף וכל ה 900 יבוצעו, כנל ביום ב. אם החלון הוא גולש/משתנה אז 900+900-1000=800 קריאות יעוכבו ויבוצעו ביום ג. בשיטה המוחלטת נראה כי **העברנו 800 קריאות יותר מידי** בתוך זמן קצר, ויתכן והעמסנו על רכיב מערכת כלשהו יותר מידי.

**חלון זמן גולש** מתאים אם כן למקרים של פרץ רגעי של קריאות לפעולה. הוא אינו תלוי בסיום והתחלה קבועים של חלון, מה שחוסך למשל בעיות של אזורי זמן. הוא מסובך לישום כי דורש ניהול מעקב אחר מונים של זמנים משתנים

**חלון זמן מוחלט** מתאים למקרים של התפלגות אחידה יחסית של קריאות לפעולה, או בדפוסים שידועים מראש. הוא פשוט יותר למימוש כי הניהול הוא של חלונות קבועים, למשל יום 
02.04.2025, שעה 22, וכדומה. יש להתחשב גם בשיקולי השירות הניתן, למשל אם בקשות שעוברות לצד ג מחויבות לפי יום קלנדרי וכדומה.

המימוש יתבצע לפי חלון זמן גולש.

# מימוש
הרעיון הוא לתעד לכל חלון זמן תור של מועדי קריאה היסטוריים. בבואה של קריאה חדשה נבדוק האם חלון הזמן לא מלא כבר בקריאות הסטוריות (זאת לאחר נקיון של קריאות ישנות מחוץ לחלון הזמן). במידה והחלון מלא נקבע את מועד הריצה לחלון הבא. במידה ולא מלא, כלומר יש מקום לריצה בחלון הנוכחי אז נקבע את מועד הריצה לעכשיו. רגע לפני הקריאה, נתעד את מועד ריצתה כמועד הסטורי של החלון.
